From a2ad3331a11ded1c42ceecd7777afc74b7c049f5 Mon Sep 17 00:00:00 2001
From: lisa_xu <lisa_xu@realsil.com.cn>
Date: Tue, 23 Apr 2024 13:41:48 +0800
Subject: [PATCH 4/4] [PATCH] openthread makefile: add macro for testharness

verification:
otbr testharness run ok.
---
 third_party/openthread/CMakeLists.txt | 13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/third_party/openthread/CMakeLists.txt b/third_party/openthread/CMakeLists.txt
index 03ad863352..1886c776f7 100644
--- a/third_party/openthread/CMakeLists.txt
+++ b/third_party/openthread/CMakeLists.txt
@@ -64,7 +64,7 @@ set(OT_SERVICE ON CACHE STRING "enable service" FORCE)
 set(OT_SLAAC ON CACHE STRING "enable SLAAC" FORCE)
 set(OT_SRP_CLIENT ON CACHE STRING "enable SRP client" FORCE)
 set(OT_TARGET_OPENWRT ${OTBR_OPENWRT} CACHE STRING "target on OpenWRT" FORCE)
-set(OT_TCP OFF CACHE STRING "disable TCP" FORCE)
+set(OT_TCP ON CACHE STRING "enable TCP" FORCE)
 set(OT_TREL ${OTBR_TREL} CACHE STRING "enable TREL" FORCE)
 set(OT_UDP_FORWARD OFF CACHE STRING "disable udp forward" FORCE)
 set(OT_UPTIME ON CACHE STRING "enable uptime" FORCE)
@@ -102,8 +102,17 @@ target_compile_definitions(ot-config INTERFACE
     "-DOPENTHREAD_CONFIG_LOG_CLI=1"
     "-DOPENTHREAD_CONFIG_MAX_STATECHANGE_HANDLERS=3"
     "-DOPENTHREAD_CONFIG_MLE_STEERING_DATA_SET_OOB_ENABLE=1"
-    "-DOPENTHREAD_CONFIG_TCP_ENABLE=0"
     "-DOPENTHREAD_POSIX_CONFIG_FILE=\"${PROJECT_BINARY_DIR}/src/agent/openthread-otbr-posix-config.h\""
+    "-DOPENTHREAD_CONFIG_MAC_SOFTWARE_ACK_TIMEOUT_ENABLE=0"
+    "-DOPENTHREAD_CONFIG_MAC_SOFTWARE_RETRANSMIT_ENABLE=1"
+    "-DOPENTHREAD_CONFIG_MAC_SOFTWARE_CSMA_BACKOFF_ENABLE=0"
+    "-DOPENTHREAD_CONFIG_MAC_SOFTWARE_TX_SECURITY_ENABLE=1"
+    "-DOPENTHREAD_CONFIG_NUM_MESSAGE_BUFFERS=160"
+    "-DOPENTHREAD_CONFIG_MLE_IP_ADDRS_PER_CHILD=4"
+    "-DOPENTHREAD_CONFIG_TMF_ADDRESS_CACHE_ENTRIES=32"
+    "-DOPENTHREAD_CONFIG_CSL_RECEIVE_TIME_AHEAD=2000"
+    "-DOPENTHREAD_CONFIG_MAC_CSL_REQUEST_AHEAD_US=5000"
+    "-DOPENTHREAD_CONFIG_PLATFORM_USEC_TIMER_ENABLE=1"
 )
 
 if (NOT OT_THREAD_VERSION STREQUAL "1.1")
-- 
2.17.1

